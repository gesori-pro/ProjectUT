<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Novel Script Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e8e8e8;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #7eb8da;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .toolbar button {
            padding: 12px 24px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4a6fa5, #166d67);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(74, 111, 165, 0.4);
        }

        .btn-secondary {
            background: rgba(60, 60, 100, 0.8);
            color: #aaa;
            border: 1px solid rgba(100, 150, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(80, 80, 120, 0.9);
            color: white;
        }

        .btn-danger {
            background: rgba(180, 60, 60, 0.8);
            color: white;
        }

        .btn-danger:hover {
            background: rgba(200, 80, 80, 0.9);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .script-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .script-item {
            background: rgba(30, 30, 50, 0.9);
            border: 1px solid rgba(100, 150, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .script-item:hover {
            border-color: rgba(100, 150, 255, 0.5);
        }

        .script-item.choice-item {
            border-left: 4px solid #f0ad4e;
        }

        .script-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .script-id {
            font-size: 18px;
            font-weight: bold;
            color: #7eb8da;
        }

        .script-controls {
            display: flex;
            gap: 8px;
        }

        .script-controls button {
            padding: 6px 12px;
            font-size: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-size: 13px;
            color: #aaa;
        }

        input,
        textarea,
        select {
            padding: 10px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            border-radius: 6px;
            background: rgba(20, 20, 40, 0.8);
            color: #e8e8e8;
            font-family: inherit;
            font-size: 14px;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: rgba(100, 150, 255, 0.7);
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .choices-container {
            background: rgba(20, 20, 40, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }

        .choice-row {
            display: grid;
            grid-template-columns: 1fr 55px 70px 70px 70px 35px;
            gap: 5px;
            margin-bottom: 10px;
            align-items: center;
        }

        .add-choice-btn {
            margin-top: 10px;
        }

        .output-area {
            margin-top: 30px;
            background: rgba(20, 20, 40, 0.9);
            border-radius: 12px;
            padding: 20px;
        }

        .output-area h3 {
            margin-bottom: 15px;
            color: #7eb8da;
        }

        #outputCode {
            width: 100%;
            min-height: 300px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .help-text {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        .toggle-type {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-type button {
            padding: 8px 16px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            background: transparent;
            color: #aaa;
            border-radius: 5px;
            cursor: pointer;
        }

        .toggle-type button.active {
            background: rgba(74, 111, 165, 0.5);
            color: white;
            border-color: rgba(100, 150, 255, 0.7);
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ“ Visual Novel Script Editor</h1>

        <div class="toolbar">
            <button class="btn-primary" onclick="addDialogue()">+ ëŒ€ì‚¬ ì¶”ê°€</button>
            <button class="btn-primary" onclick="addChoice()">+ ì„ íƒì§€ ì¶”ê°€</button>
            <button class="btn-secondary" onclick="loadFromFile()">ğŸ“‚ íŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn-primary" onclick="generateCode()">ğŸ’¾ ì½”ë“œ ìƒì„±</button>
            <button class="btn-secondary" onclick="copyCode()">ğŸ“‹ ë³µì‚¬</button>
        </div>

        <div class="script-list" id="scriptList">
            <!-- ìŠ¤í¬ë¦½íŠ¸ ì•„ì´í…œë“¤ì´ ì—¬ê¸° ì¶”ê°€ë¨ -->
        </div>

        <div class="output-area">
            <h3>ìƒì„±ëœ SCRIPT ì½”ë“œ</h3>
            <p class="help-text">ì•„ë˜ ì½”ë“œë¥¼ script-data.jsì˜ SCRIPT ë°°ì—´ ë¶€ë¶„ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
            <textarea id="outputCode" readonly></textarea>
        </div>
    </div>

    <script>
        let scriptItems = [];
        let nextId = 1;

        // ëŒ€ì‚¬ ì•„ì´í…œ ì¶”ê°€
        function addDialogue(data = null) {
            const item = {
                type: 'dialogue',
                id: data?.id || nextId++,
                name: data?.name || '',
                text: data?.text || '',
                background: data?.background || '',
                bgm: data?.bgm || '',
                charLeft: data?.characters?.left || '',
                charCenter: data?.characters?.center || '',
                charRight: data?.characters?.right || '',
                speaker: data?.speaker || '',
                boxOpacity: data?.boxOpacity ?? '',
                nextId: data?.nextId ?? ''
            };
            scriptItems.push(item);
            renderList();
        }

        // ì„ íƒì§€ ì•„ì´í…œ ì¶”ê°€
        function addChoice(data = null) {
            const item = {
                type: 'choice',
                id: data?.id || nextId++,
                layout: data?.layout || 'three',
                charLeft: data?.characters?.left || '',
                charCenter: data?.characters?.center || '',
                charRight: data?.characters?.right || '',
                nextId: data?.nextId ?? '',
                choices: data?.choices || [
                    { text: '', nextId: '', x: '', y: '' },
                    { text: '', nextId: '', x: '', y: '' }
                ]
            };
            scriptItems.push(item);
            renderList();
        }

        // ì•„ì´í…œ ì‚­ì œ
        function deleteItem(index) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                scriptItems.splice(index, 1);
                renderList();
            }
        }

        // ì•„ì´í…œ ì´ë™
        function moveItem(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= scriptItems.length) return;

            [scriptItems[index], scriptItems[newIndex]] = [scriptItems[newIndex], scriptItems[index]];
            renderList();
        }

        function addChoiceOption(index) {
            scriptItems[index].choices.push({ text: '', nextId: '', x: '', y: '' });
            renderList();
        }

        // ì„ íƒì§€ ì‚­ì œ
        function removeChoiceOption(itemIndex, choiceIndex) {
            if (scriptItems[itemIndex].choices.length > 1) {
                scriptItems[itemIndex].choices.splice(choiceIndex, 1);
                renderList();
            }
        }

        // ì…ë ¥ê°’ ì—…ë°ì´íŠ¸
        function updateValue(index, field, value) {
            scriptItems[index][field] = value;
        }

        // ì„ íƒì§€ ê°’ ì—…ë°ì´íŠ¸
        function updateChoiceValue(itemIndex, choiceIndex, field, value) {
            scriptItems[itemIndex].choices[choiceIndex][field] = value;
        }

        // ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        function renderList() {
            const container = document.getElementById('scriptList');
            container.innerHTML = '';

            scriptItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'script-item' + (item.type === 'choice' ? ' choice-item' : '');

                if (item.type === 'dialogue') {
                    div.innerHTML = `
                        <div class="script-header">
                            <span class="script-id">ID: <input type="number" value="${item.id}" 
                                onchange="updateValue(${index}, 'id', parseInt(this.value))" 
                                style="width: 60px;"></span>
                            <div class="script-controls">
                                <button class="btn-secondary" onclick="moveItem(${index}, -1)">â†‘</button>
                                <button class="btn-secondary" onclick="moveItem(${index}, 1)">â†“</button>
                                <button class="btn-danger" onclick="deleteItem(${index})">ì‚­ì œ</button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>í™”ì ì´ë¦„</label>
                                <input type="text" value="${item.name}" 
                                    onchange="updateValue(${index}, 'name', this.value)"
                                    placeholder="ë¹„ì›Œë‘ë©´ ë‚˜ë ˆì´ì…˜">
                            </div>
                            <div class="form-group">
                                <label>ë°°ê²½ (ê²½ë¡œ)</label>
                                <input type="text" value="${item.background}" 
                                    onchange="updateValue(${index}, 'background', this.value)"
                                    placeholder="ì˜ˆ: Background/Daytime.png">
                            </div>
                            <div class="form-group">
                                <label>BGM (ê²½ë¡œ)</label>
                                <input type="text" value="${item.bgm}" 
                                    onchange="updateValue(${index}, 'bgm', this.value)"
                                    placeholder="ì˜ˆ: bgm/Main_theme.mp3">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ìº¡ë¦­í„° ì™¼ìª½</label>
                                <input type="text" value="${item.charLeft || ''}" 
                                    onchange="updateValue(${index}, 'charLeft', this.value)"
                                    placeholder="Character/xxx.png">
                            </div>
                            <div class="form-group">
                                <label>ìº¡ë¦­í„° ì¤‘ì•™</label>
                                <input type="text" value="${item.charCenter || ''}" 
                                    onchange="updateValue(${index}, 'charCenter', this.value)"
                                    placeholder="Character/xxx.png">
                            </div>
                            <div class="form-group">
                                <label>ìº¡ë¦­í„° ì˜¤ë¥¸ìª½</label>
                                <input type="text" value="${item.charRight || ''}" 
                                    onchange="updateValue(${index}, 'charRight', this.value)"
                                    placeholder="Character/xxx.png">
                            </div>
                            <div class="form-group">
                                <label>í™”ì ìœ„ì¹˜</label>
                                <select onchange="updateValue(${index}, 'speaker', this.value)">
                                    <option value="" ${!item.speaker ? 'selected' : ''}>ì—†ìŒ</option>
                                    <option value="left" ${item.speaker === 'left' ? 'selected' : ''}>ì™¼ìª½</option>
                                    <option value="center" ${item.speaker === 'center' ? 'selected' : ''}>ì¤‘ì•™</option>
                                    <option value="right" ${item.speaker === 'right' ? 'selected' : ''}>ì˜¤ë¥¸ìª½</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label>ëŒ€ì‚¬ í…ìŠ¤íŠ¸ (ì¤„ë°”ê¿ˆ: &lt;br&gt;)</label>
                                <textarea onchange="updateValue(${index}, 'text', this.value)"
                                    placeholder="ëŒ€ì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">${item.text}</textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ëŒ€í™”ì°½ íˆ¬ëª…ë„ (0~1)</label>
                                <input type="number" step="0.1" min="0" max="1" value="${item.boxOpacity}" 
                                    onchange="updateValue(${index}, 'boxOpacity', this.value ? parseFloat(this.value) : '')"
                                    placeholder="ê¸°ë³¸ê°’ ì‚¬ìš©">
                            </div>
                            <div class="form-group">
                                <label>ë‹¤ìŒ IDë¡œ ì´ë™ (ì„ íƒ)</label>
                                <input type="number" value="${item.nextId}" 
                                    onchange="updateValue(${index}, 'nextId', this.value ? parseInt(this.value) : '')"
                                    placeholder="ë¹„ì›Œë‘ë©´ ìˆœì°¨ ì§„í–‰">
                            </div>
                        </div>
                    `;
                } else {
                    let choicesHtml = item.choices.map((choice, cIndex) => `
                        <div class="choice-item" style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 5px; margin-bottom: 8px;">
                            <div class="choice-row">
                                <input type="text" value="${choice.text}" 
                                    onchange="updateChoiceValue(${index}, ${cIndex}, 'text', this.value)"
                                    placeholder="ì„ íƒì§€ í…ìŠ¤íŠ¸">
                                <input type="number" value="${choice.nextId}" 
                                    onchange="updateChoiceValue(${index}, ${cIndex}, 'nextId', parseInt(this.value))"
                                    placeholder="ID">
                                <input type="number" value="${choice.x !== undefined ? choice.x : ''}" 
                                    onchange="updateChoiceValue(${index}, ${cIndex}, 'x', this.value ? parseInt(this.value) : '')"
                                    placeholder="X">
                                <input type="number" value="${choice.y !== undefined ? choice.y : ''}" 
                                    onchange="updateChoiceValue(${index}, ${cIndex}, 'y', this.value ? parseInt(this.value) : '')"
                                    placeholder="Y">
                                <select onchange="updateChoiceValue(${index}, ${cIndex}, 'target', this.value)">
                                    <option value="" ${!choice.target ? 'selected' : ''}>íƒ€ê²Ÿ</option>
                                    <option value="left" ${choice.target === 'left' ? 'selected' : ''}>ì™¼ìª½</option>
                                    <option value="center" ${choice.target === 'center' ? 'selected' : ''}>ì¤‘ì•™</option>
                                    <option value="right" ${choice.target === 'right' ? 'selected' : ''}>ì˜¤ë¥¸ìª½</option>
                                </select>
                                <button class="btn-danger" onclick="removeChoiceOption(${index}, ${cIndex})">Ã—</button>
                            </div>
                            <div style="display: flex; gap: 8px; margin-top: 5px; align-items: center;">
                                <input type="text" value="${choice.image || ''}" 
                                    onchange="updateChoiceValue(${index}, ${cIndex}, 'image', this.value)"
                                    placeholder="ì´ë¯¸ì§€ ê²½ë¡œ (ì˜ˆ: images/icon.png)" style="flex: 1;">
                                <label style="display: flex; align-items: center; gap: 4px; white-space: nowrap;">
                                    <input type="checkbox" ${choice.once ? 'checked' : ''} 
                                        onchange="updateChoiceValue(${index}, ${cIndex}, 'once', this.checked)">
                                    1íšŒë§Œ
                                </label>
                            </div>
                        </div>
                    `).join('');

                    div.innerHTML = `
                        <div class="script-header">
                            <span class="script-id">ID: <input type="number" value="${item.id}" 
                                onchange="updateValue(${index}, 'id', parseInt(this.value))" 
                                style="width: 60px;"> [ì„ íƒì§€]</span>
                            <div class="script-controls">
                                <button class="btn-secondary" onclick="moveItem(${index}, -1)">â†‘</button>
                                <button class="btn-secondary" onclick="moveItem(${index}, 1)">â†“</button>
                                <button class="btn-danger" onclick="deleteItem(${index})">ì‚­ì œ</button>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ë ˆì´ì•„ì›ƒ</label>
                                <select onchange="updateValue(${index}, 'layout', this.value)">
                                    <option value="three" ${item.layout === 'three' ? 'selected' : ''}>3ì¸</option>
                                    <option value="two" ${item.layout === 'two' ? 'selected' : ''}>2ì¸</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ìºë¦­í„° ì™¼ìª½</label>
                                <input type="text" value="${item.charLeft || ''}" 
                                    onchange="updateValue(${index}, 'charLeft', this.value)"
                                    placeholder="Character/xxx.png">
                            </div>
                            <div class="form-group">
                                <label>ìºë¦­í„° ì¤‘ì•™</label>
                                <input type="text" value="${item.charCenter || ''}" 
                                    onchange="updateValue(${index}, 'charCenter', this.value)"
                                    placeholder="Character/xxx.png" ${item.layout === 'two' ? 'disabled' : ''}>
                            </div>
                            <div class="form-group">
                                <label>ìºë¦­í„° ì˜¤ë¥¸ìª½</label>
                                <input type="text" value="${item.charRight || ''}" 
                                    onchange="updateValue(${index}, 'charRight', this.value)"
                                    placeholder="Character/xxx.png">
                            </div>
                            <div class="form-group">
                                <label>ì™„ë£Œ í›„ ì´ë™ ID</label>
                                <input type="number" value="${item.nextId !== undefined ? item.nextId : ''}" 
                                    onchange="updateValue(${index}, 'nextId', this.value ? parseInt(this.value) : '')"
                                    placeholder="ëª¨ë“  ì„ íƒ í›„">
                            </div>
                        </div>
                        <div class="choices-container">
                            <label>ì„ íƒì§€ ëª©ë¡</label>
                            ${choicesHtml}
                            <button class="btn-secondary add-choice-btn" onclick="addChoiceOption(${index})">+ ì„ íƒì§€ ì¶”ê°€</button>
                        </div>
                    `;
                }

                container.appendChild(div);
            });
        }

        // ì½”ë“œ ìƒì„±
        function generateCode() {
            let code = '// ê²Œì„ ì„¤ì •\n';
            code += 'const GAME_CONFIG = {\n';
            code += '    textSpeed: 30,      // í…ìŠ¤íŠ¸ íƒ€ì´í•‘ ì†ë„ (ms) - ë‚®ì„ìˆ˜ë¡ ë¹ ë¦„\n';
            code += '    autoDelay: 2000,    // ì˜¤í†  ëª¨ë“œì—ì„œ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ë”œë ˆì´ (ms)\n';
            code += '    skipSpeed: 5,       // ìŠ¤í‚µ ëª¨ë“œ í…ìŠ¤íŠ¸ ì†ë„ (ms)\n';
            code += '};\n\n';
            code += 'const SCRIPT = [\n';

            scriptItems.forEach((item, index) => {
                code += '    {\n';
                code += `        id: ${item.id},\n`;

                if (item.type === 'dialogue') {
                    if (item.background) code += `        background: "${item.background}",\n`;
                    if (item.bgm) code += `        bgm: "${item.bgm}",\n`;
                    // ìºë¦­í„° ì´ë¯¸ì§€
                    if (item.charLeft || item.charCenter || item.charRight) {
                        code += '        characters: {\n';
                        if (item.charLeft) code += `            left: "${item.charLeft}",\n`;
                        if (item.charCenter) code += `            center: "${item.charCenter}",\n`;
                        if (item.charRight) code += `            right: "${item.charRight}",\n`;
                        code += '        },\n';
                    }
                    if (item.speaker) code += `        speaker: "${item.speaker}",\n`;
                    if (item.name) code += `        name: "${item.name}",\n`;
                    if (item.text) code += `        text: "${item.text.replace(/"/g, '\\"')}",\n`;
                    if (item.boxOpacity !== '' && item.boxOpacity !== undefined) {
                        code += `        boxOpacity: ${item.boxOpacity},\n`;
                    }
                    if (item.nextId !== '' && item.nextId !== undefined) {
                        code += `        nextId: ${item.nextId},\n`;
                    }
                } else {
                    // ë ˆì´ì•„ì›ƒ (2ì¸/3ì¸)
                    if (item.layout && item.layout !== 'three') {
                        code += `        layout: "${item.layout}",\n`;
                    }
                    // ìºë¦­í„° ì´ë¯¸ì§€ (ì„ íƒì§€ìš©)
                    if (item.charLeft || item.charCenter || item.charRight) {
                        code += '        characters: {\n';
                        if (item.charLeft) code += `            left: "${item.charLeft}",\n`;
                        if (item.charCenter && item.layout !== 'two') code += `            center: "${item.charCenter}",\n`;
                        if (item.charRight) code += `            right: "${item.charRight}",\n`;
                        code += '        },\n';
                    }
                    // ì™„ë£Œ í›„ ì´ë™ ID
                    if (item.nextId !== undefined && item.nextId !== '') {
                        code += `        nextId: ${item.nextId},\n`;
                    }
                    code += '        choices: [\n';
                    item.choices.forEach((choice, cIndex) => {
                        let choiceStr = `{ text: "${choice.text.replace(/"/g, '\\"')}", nextId: ${choice.nextId}`;
                        if (choice.x !== '' && choice.x !== undefined) {
                            choiceStr += `, x: ${choice.x}`;
                        }
                        if (choice.y !== '' && choice.y !== undefined) {
                            choiceStr += `, y: ${choice.y}`;
                        }
                        if (choice.target) {
                            choiceStr += `, target: "${choice.target}"`;
                        }
                        if (choice.image) {
                            choiceStr += `, image: "${choice.image}"`;
                        }
                        if (choice.once) {
                            choiceStr += `, once: true`;
                        }
                        choiceStr += ' }';
                        code += `            ${choiceStr}`;
                        code += cIndex < item.choices.length - 1 ? ',\n' : '\n';
                    });
                    code += '        ]\n';
                }

                code += '    }';
                code += index < scriptItems.length - 1 ? ',\n' : '\n';
            });

            code += '];\n';
            code += '\n// ìŠ¤í¬ë¦½íŠ¸ ë§µ ìƒì„±\n';
            code += 'const SCRIPT_MAP = {};\n';
            code += 'SCRIPT.forEach((item, index) => {\n';
            code += '    SCRIPT_MAP[item.id] = { ...item, _index: index };\n';
            code += '});\n';

            document.getElementById('outputCode').value = code;
        }

        // ì½”ë“œ ë³µì‚¬
        function copyCode() {
            const output = document.getElementById('outputCode');
            output.select();
            document.execCommand('copy');
            alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // íŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° (script-data.jsë¥¼ ì§ì ‘ íŒŒì‹±)
        function loadFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.js';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const content = event.target.result;
                        // SCRIPT ë°°ì—´ ì¶”ì¶œ ì‹œë„
                        const scriptMatch = content.match(/const SCRIPT\s*=\s*\[([\s\S]*?)\];/);
                        if (scriptMatch) {
                            // ê°„ë‹¨í•œ íŒŒì‹± (eval ì‚¬ìš© - ë³´ì•ˆ ì£¼ì˜)
                            const scriptContent = scriptMatch[1];
                            // ì •ê·œì‹ìœ¼ë¡œ ê° ì•„ì´í…œ ì¶”ì¶œ
                            parseScriptContent(content);
                            alert('íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
                        } else {
                            alert('SCRIPT ë°°ì—´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                        }
                    } catch (err) {
                        alert('íŒŒì¼ íŒŒì‹± ì˜¤ë¥˜: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš© íŒŒì‹±
        function parseScriptContent(content) {
            try {
                // ì„ì‹œë¡œ evalì„ ì‚¬ìš©í•˜ì—¬ SCRIPT ë°°ì—´ ì¶”ì¶œ
                // BACKGROUNDSì™€ CHARACTERSë¥¼ ë¹ˆ ê°ì²´ë¡œ ëŒ€ì²´
                const safeContent = content
                    .replace(/BACKGROUNDS\.\w+/g, '""')
                    .replace(/CHARACTERS\.\w+(\?\.\w+)*/g, '""');

                // SCRIPT ë°°ì—´ë§Œ ì¶”ì¶œ
                const match = safeContent.match(/const SCRIPT\s*=\s*(\[[\s\S]*?\]);/);
                if (match) {
                    const scriptArray = eval(match[1]);
                    scriptItems = [];
                    nextId = 1;

                    scriptArray.forEach(item => {
                        if (item.choices) {
                            addChoice(item);
                        } else {
                            addDialogue(item);
                        }
                        if (item.id >= nextId) nextId = item.id + 1;
                    });
                }
            } catch (err) {
                console.error('íŒŒì‹± ì˜¤ë¥˜:', err);
                alert('íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
            }
        }

        // ì´ˆê¸° ì˜ˆì‹œ ì¶”ê°€
        addDialogue({ id: 1, text: 'ì—¬ê¸°ì— ëŒ€ì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.' });
    </script>
</body>

</html>